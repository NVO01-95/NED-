<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}NED{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pages.css') }}">
</head>
<body>

<header class="top-nav">
  <div class="top-nav-inner">

    <a class="brand" href="{{ url_for('home') }}">
      <span class="brand-mark">N</span>
      <span class="brand-text">
        <span class="title">NED</span>
        <span class="sub">Nautical Essential Dashboard</span>
      </span>
    </a>

    <!-- Hamburger -->
    <button class="menu-btn" type="button" aria-label="Open menu" onclick="toggleMenu(true)">
      ☰
    </button>

    <!-- spacer: pushes actions to the right edge -->
    <div class="nav-spacer"></div>

    <div class="nav-actions">
      {% if current_username %}
        <span class="user-chip">Hi, {{ current_username }}</span>
        <a href="{{ url_for('logout') }}" class="btn-nav">Logout</a>
      {% else %}
        <a href="{{ url_for('login') }}" class="btn-nav">Login</a>
        <a href="{{ url_for('register') }}" class="btn-nav primary">Register</a>
      {% endif %}
    </div>

  </div>
</header>

<!-- Drawer + overlay -->
<div id="menuOverlay" class="menu-overlay" onclick="toggleMenu(false)"></div>

<aside id="menuDrawer" class="menu-drawer" aria-hidden="true">
  <div class="menu-drawer-head">
    <div class="menu-drawer-title">Menu</div>
    <button class="menu-close" type="button" aria-label="Close menu" onclick="toggleMenu(false)">✕</button>
  </div>

  <nav class="menu-drawer-links">
    <a href="{{ url_for('home') }}">Home</a>
    <a href="{{ url_for('route_planner') }}">Route Planner</a>
    <a href="{{ url_for('voyage_sheet') }}">Voyage Sheet</a>
    <a href="{{ url_for('logbook') }}">Logbook</a>
    <a href="{{ url_for('contacts') }}">Contacts</a>
    <a href="{{ url_for('weather') }}">Weather</a>
    <a href="{{ url_for('communication') }}">Communication</a>
    <a href="{{ url_for('help_page') }}">Help</a>

    {% if current_username %}
      <a href="{{ url_for('settings') }}">Settings</a>
      <a href="{{ url_for('admin_panel') }}">Admin</a>
    {% endif %}
  </nav>

  <div class="menu-drawer-foot small-hint">
    Tip: Home shows quick tiles. Use Menu for full navigation.
  </div>
</aside>

<main class="ned-main">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-wrap">
        {% for category, msg in messages %}
          <div class="flash flash-{{ category }}">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {% block content %}{% endblock %}
</main>

<footer class="ned-footer">
  <small>© 2025 NED – Nautical Essential Dashboard · Made by NVO</small>
</footer>

<script>
  function toggleMenu(open) {
    const drawer = document.getElementById("menuDrawer");
    const overlay = document.getElementById("menuOverlay");
    if (!drawer || !overlay) return;

    if (open) {
      drawer.classList.add("open");
      overlay.classList.add("open");
      drawer.setAttribute("aria-hidden", "false");
    } else {
      drawer.classList.remove("open");
      overlay.classList.remove("open");
      drawer.setAttribute("aria-hidden", "true");
    }
  }

  // close with ESC
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") toggleMenu(false);
  });

  // STATS: animate numbers when #stats enters viewport (homepage)
  (function(){
    const statsRoot = document.getElementById("stats");
    const counters = document.querySelectorAll(".stat-value[data-count]");
    if (!statsRoot || !counters.length) return;

    function animate(el){
      const target = parseFloat(el.getAttribute("data-count") || "0");
      const suffix = el.getAttribute("data-suffix") || "";
      const duration = 900;
      const start = performance.now();

      function tick(now){
        const t = Math.min((now - start) / duration, 1);
        const eased = 1 - Math.pow(1 - t, 3); // easeOutCubic
        const val = Math.round(target * eased);
        el.textContent = `${val}${suffix}`;
        if (t < 1) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    }

    const obs = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (!e.isIntersecting) return;
        counters.forEach(el => {
          if (el.dataset.done) return;
          el.dataset.done = "1";
          animate(el);
        });
        obs.disconnect();
      });
    }, { threshold: 0.35 });

    obs.observe(statsRoot);
  })();
</script>

</body>
</html>

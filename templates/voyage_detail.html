{% extends "base.html" %}
{% block title %}Voyage · NED{% endblock %}

{% block content %}
<section class="ned-card">
  <h2>Voyage</h2>

  <p class="small-hint">
    <strong>{{ voyage.title if voyage.title else (voyage.departure ~ " → " ~ voyage.destination) }}</strong><br>
    Departure: {{ voyage.departure }} · Destination: {{ voyage.destination }}<br>
    Done at: {{ voyage.done_at if voyage.done_at else "-" }}
  </p>

  {% if voyage.route_snapshot and voyage.route_snapshot.calc %}
    <p class="small-hint">
      Total: {{ voyage.route_snapshot.calc.total_nm }} NM · ETA: {{ voyage.route_snapshot.calc.total_eta_hhmm }}
    </p>
  {% endif %}

  {% if is_authenticated and (is_admin or is_owner) %}
    <form method="post">
      <div class="form-row">
        <label for="tags">Tags (comma separated)</label>
        <input id="tags" name="tags" type="text"
               value="{{ (voyage.tags|join(', ')) if voyage.tags else '' }}"
               placeholder="shallow, windy, traffic">
      </div>

      <div class="form-row">
        <label for="notes">Notes / Lessons learned</label>
        <textarea id="notes" name="notes" rows="10"
                  placeholder="What happened, what to remember next time...">{{ voyage.notes if voyage.notes else '' }}</textarea>
        <p class="small-hint">Tip: keep it short and practical (hazards, communications, docking notes).</p>
      </div>

      <button type="submit" class="btn">Save</button>
      <a class="nav-link" href="{{ url_for('voyage_sheet') }}">Back to Voyages</a>
    </form>
  {% else %}
    <div class="form-row">
      <label>Tags</label>
      <p class="small-hint">
        {{ (voyage.tags|join(', ')) if voyage.tags else "-" }}
      </p>
    </div>

    <div class="form-row">
      <label>Notes / Lessons learned</label>
      {% if voyage.notes %}
        <p class="small-hint" style="white-space: pre-wrap;">{{ voyage.notes }}</p>
      {% else %}
        <p class="small-hint">No notes yet.</p>
      {% endif %}
    </div>

    <p class="small-hint">
      {% if not is_authenticated %}
        Log in to add notes to this voyage.
      {% else %}
        You can view this voyage, but only the author/admin can edit it.
      {% endif %}
    </p>

    <a class="nav-link" href="{{ url_for('voyage_sheet') }}">Back to Voyages</a>
  {% endif %}
</section>
{% endblock %}

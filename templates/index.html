{% extends "base.html" %}

{% block title %}NED · Dashboard{% endblock %}

{% block content %}

{# ===================== HERO ===================== #}
<section class="ned-hero">
  <div class="ned-hero-text">
    <h1>NED – Nautical Essential Dashboard</h1>
    <p class="hero-subtitle">
      Practical planning & logging for inland navigation — built for the Danube, ports and small vessels.
    </p>

    <ul class="hero-points">
      <li>✔ Plan routes and voyages with confidence</li>
      <li>✔ Avoid common beginner mistakes (checklists, notes, local tips)</li>
      <li>✔ Keep routes, contacts, weather notes and logbook in one place</li>
    </ul>

    <div class="hero-actions">
      <a href="{{ url_for('route_planner') }}" class="btn">Start Route Planning</a>

      {# Optional: un CTA secundar doar pentru useri logati #}
      {% if current_username %}
        <a href="{{ url_for('voyage_sheet') }}" class="btn btn-secondary">Open Voyage Sheet</a>
      {% endif %}
    </div>

    {% if current_username %}
      <p class="home-hero-status">
        Logged in as <strong>{{ current_username }}</strong>. Your routes, voyages and logbook entries are linked to this account.
      </p>
    {% else %}
      <p class="home-hero-status">
        You are browsing as a guest. You can explore all sections, but saving/editing is available for logged-in users.
      </p>
    {% endif %}
  </div>

  <div class="ned-hero-images">
    <div class="hero-img-wrap">
      <img src="{{ url_for('static', filename='img/danube_map.jpg') }}" alt="Danube navigation map">
      <div class="hero-img-caption">Danube context • ports • river navigation</div>
    </div>
    <div class="hero-img-wrap">
      <img src="{{ url_for('static', filename='img/small_boat.jpg') }}" alt="Small inland navigation boat">
      <div class="hero-img-caption">Small vessels • practical planning • safe habits</div>
    </div>
  </div>
</section>

{# ===================== STATS (animated on scroll) ===================== #}
<section class="ned-card stats-wrap">
  <div class="stats-head">
    <div>
      <h3 style="margin:0;">NED in numbers</h3>
      <p class="small-hint" style="margin:6px 0 0;">
        Quick snapshot of your activity and what NED helps with.
      </p>
    </div>
  </div>

  <div class="stats-grid">
    <div class="stat">
      <div class="stat-value" data-count="9" data-suffix="">0</div>
      <div class="stat-label">Ports saved</div>
      <div class="stat-sub">Local locations database</div>
    </div>

    <div class="stat">
      <div class="stat-value" data-count="{{ summary.routes if summary else 0 }}" data-suffix="">0</div>
      <div class="stat-label">Routes planned</div>
      <div class="stat-sub">Reusable templates</div>
    </div>

    <div class="stat">
      <div class="stat-value" data-count="{{ summary.voyages if summary else 0 }}" data-suffix="">0</div>
      <div class="stat-label">Voyages logged</div>
      <div class="stat-sub">Your voyage sheet</div>
    </div>

    <div class="stat">
      <div class="stat-value" data-count="92" data-suffix="%">0%</div>
      <div class="stat-label">Checklist readiness</div>
      <div class="stat-sub">Example metric (customizable)</div>
    </div>
  </div>
</section>

{# ===================== TESTIMONIALS (single section) ===================== #}
<section class="ned-card testi-wrap" id="testimonials">
  <div class="testi-head">
    <div>
      <h3 style="margin:0;">What users say</h3>
      <p class="small-hint" style="margin:6px 0 0;">
        Short feedback from small craft users & inland crews.
      </p>
    </div>
  </div>

  <div class="testi-grid">
    <article class="testi">
      <p class="testi-text">“The route templates + quick ETA help a lot before casting off. Simple and practical.”</p>
      <div class="testi-foot">
        <span class="testi-name">C. — small craft (Danube)</span>
        <span class="testi-tag">Route Planner</span>
      </div>
    </article>

    <article class="testi">
      <p class="testi-text">“Communication phrases saved time when we were in mixed-language sectors.”</p>
      <div class="testi-foot">
        <span class="testi-name">M. — river crew</span>
        <span class="testi-tag">Communication</span>
      </div>
    </article>

    <article class="testi">
      <p class="testi-text">“Having contacts per port + personal notes in one place is exactly what we needed.”</p>
      <div class="testi-foot">
        <span class="testi-name">A. — port visits</span>
        <span class="testi-tag">Contacts</span>
      </div>
    </article>
  </div>
</section>

{# ===================== QUICK TILES (NO DUPLICATES) ===================== #}
<section class="home-grid modern-tiles">
  <a class="tile ned-card" href="{{ url_for('logbook') }}">
    <div class="tile-badge">Log</div>
    <h3>Logbook</h3>
    <p>Record navigation events, weather and technical notes by date and time.</p>
  </a>

  <a class="tile ned-card" href="{{ url_for('contacts') }}">
    <div class="tile-badge">Ports</div>
    <h3>Contacts Hub</h3>
    <p>Official port contacts + your personal network (agents, pilots, local tips).</p>
  </a>

  <a class="tile ned-card" href="{{ url_for('weather') }}">
    <div class="tile-badge">Wx</div>
    <h3>Weather Center</h3>
    <p>Quick links to sources + your own observations and situational notes.</p>
  </a>

  <a class="tile ned-card" href="{{ url_for('communication') }}">
    <div class="tile-badge">Comms</div>
    <h3>Communication</h3>
    <p>Phrases and quick notes for mixed-language sectors and port coordination.</p>
  </a>

  <a class="tile ned-card" href="{{ url_for('help_page') }}">
    <div class="tile-badge">Help</div>
    <h3>Help</h3>
    <p>How to use NED, best practices, examples and quick tips.</p>
  </a>

  {% if current_username %}
  <a class="tile ned-card" href="{{ url_for('settings') }}">
    <div class="tile-badge">Data</div>
    <h3>Settings & Data</h3>
    <p>Export/import your local JSON and manage stored data safely.</p>
  </a>
  {% endif %}
</section>

{# ===================== OPTIONAL ANALYTICS ===================== #}
{% if voyage_stats and voyage_stats.total_distance_nm > 0 %}
<section class="ned-card">
  <h3>Voyage analytics</h3>

  <p>
    Total logged distance:
    <strong>{{ voyage_stats.total_distance_nm }} NM</strong>
  </p>

  {% if voyage_stats.longest_voyage %}
    <p>
      Longest voyage:
      <strong>{{ voyage_stats.longest_voyage.departure }}</strong>
      &rarr;
      <strong>{{ voyage_stats.longest_voyage.destination }}</strong>
      ({{ voyage_stats.longest_voyage.distance_nm }} NM)
    </p>
  {% endif %}

  {% if voyage_stats.top_departures %}
    <p>
      Most common departure ports:
      {% for port, count in voyage_stats.top_departures %}
        <span>{{ port }} ({{ count }}){% if not loop.last %}, {% endif %}</span>
      {% endfor %}
    </p>
  {% endif %}

  {% if voyage_stats.top_destinations %}
    <p>
      Most common destinations:
      {% for port, count in voyage_stats.top_destinations %}
        <span>{{ port }} ({{ count }}){% if not loop.last %}, {% endif %}</span>
      {% endfor %}
    </p>
  {% endif %}
</section>
{% endif %}

{# ===================== STATS COUNTER SCRIPT ===================== #}
<script>
(function(){
  const els = document.querySelectorAll(".stat-value[data-count]");
  if (!els.length) return;

  function animate(el){
    const target = parseFloat(el.dataset.count || "0");
    const suffix = el.dataset.suffix || "";
    const isPercent = suffix === "%";
    const duration = 800;
    const start = performance.now();

    function tick(now){
      const p = Math.min(1, (now - start) / duration);
      const val = Math.round(target * p);
      el.textContent = isPercent ? (val + "%") : (val + suffix);
      if (p < 1) requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  }

  const io = new IntersectionObserver((entries) => {
    entries.forEach(e => {
      if (e.isIntersecting && !e.target.dataset.done){
        e.target.dataset.done = "1";
        animate(e.target);
      }
    });
  }, { threshold: 0.35 });

  els.forEach(el => io.observe(el));
})();
</script>

{% endblock %}
